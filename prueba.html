<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gesti칩n Albergue - Ver.3.1.5</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
    <div class="version-tag">Ver.3.1.5</div>
    <div id="toast" style="visibility: hidden;">Guardado autom치tico</div>
    <div id="loading-overlay" class="hidden"><div class="spinner"></div><h2 style="color:var(--primary);">Cargando Datos...</h2></div>
    <div id="black-box-overlay" class="hidden">
        <div class="bb-header">
            <span><i class="fa-solid fa-terminal"></i> SYSTEM LOG (CAJA NEGRA)</span>
            <div>
                <button class="bb-btn" onclick="window.limpiarCajaNegra()">LIMPIAR</button>
                <button class="bb-btn close" onclick="window.toggleCajaNegra()">X</button>
            </div>
        </div>
        <div id="black-box-content"></div>
    </div>
    <div id="login-screen" class="">
        <div class="card">
            <h1 style="color:var(--primary); margin-bottom:20px;"><i class="fa-solid fa-hotel"></i> Acceso</h1>
            <input type="email" id="login-email" placeholder="Correo electr칩nico">
            <input type="password" id="login-pass" placeholder="Contrase침a">
            <button class="primary" style="width:100%" onclick="window.iniciarSesion()">Iniciar Sesi칩n</button>
            <p class="forgot-password" onclick="window.mostrarModalResetPass()">쯆lvidaste tu contrase침a?</p>
        </div>
    </div>
    <div id="app-shell" class="hidden">
        <header class="app-header">
            <div class="brand"><i class="fa-solid fa-campground"></i> ALBERGUE PRO</div>
            <div class="user-profile">
                <div class="user-info">
                    <span class="user-name" id="user-name-display">...</span>
                    <span class="user-role" id="user-role-badge">...</span>
                </div>
                <button id="header-btn-debug" class="btn-icon btn-debug hidden" onclick="window.toggleCajaNegra()" title="Abrir Log Sistema"><i class="fa-solid fa-terminal"></i></button>
                <button id="header-btn-users" class="btn-icon hidden" onclick="window.navegar('usuarios')" title="Gestionar Usuarios"><i class="fa-solid fa-users-gear"></i></button>
                                <button class="btn-icon btn-key" onclick="window.abrirModalCambioPass()" title="Cambiar Contrase침a"><i class="fa-solid fa-key"></i></button>
                <button class="btn-logout" onclick="window.cerrarSesion()"><i class="fa-solid fa-power-off"></i></button>
            </div>
        </header>
        <main class="main-content">
            <!-- ... resto del layout y pantallas ... -->
            <!-- Aqu칤 tu pantalla para pre-filiaci칩n: -->
            <div id="form-manual-container" style="margin-top:15px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h4>Registro en Pre-Filiaci칩n</h4>
                    <div>
                        <button id="btn-cancelar-edicion-pref" class="secondary hidden" style="font-size:0.7em; padding:4px 8px;" onclick="window.cancelarEdicionPref()">Cancelar Edici칩n</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col"><label>Nombre <span style="color:red">*</span></label><input type="text" id="man-nombre"></div>
                    <div class="col"><label>Apellido 1 <span style="color:red">*</span></label><input type="text" id="man-ap1"></div>
                    <div class="col"><label>Apellido 2</label><input type="text" id="man-ap2"></div>
                </div>
                <div class="row">
                    <div class="col"><label>Tel칠fono <span style="color:red">*</span></label><input type="tel" id="man-tel"></div>
                    <div class="col">
                        <label>Tipo de Documento</label>
                        <select id="man-tipo-doc" onchange="window.onCambioTipoDocumento()">
                            <option value="DNI">DNI</option>
                            <option value="NIE">NIE</option>
                            <option value="PASAPORTE">PASAPORTE</option>
                            <option value="SINDNI">Sin DNI/NIE (Ni침os)</option>
                        </select>
                    </div>
                    <div class="col"><label>N칰mero de Documento</label><input type="text" id="man-doc-num"></div>
                </div>
                <div class="row">
                    <div class="col"><label>Fecha de Nacimiento</label><input type="date" id="man-fecha"></div>
                </div>
                <div class="row">
                    <div class="col"><label>쯊iene alg칰n tipo de intolerancia?</label>
                        <select id="man-intolerancia" onchange="window.onCambioIntolerancia()">
                            <option value="NO">No</option>
                            <option value="SI">S칤</option>
                        </select>
                    </div>
                    <div class="col" id="indique-intolerancia-container" style="display:none;">
                        <label>Indique Intolerancia</label>
                        <input type="text" id="man-intolerancia-detalle">
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label>
                            <input type="checkbox" id="man-no-localizar" style="vertical-align:middle;"> Marque esta casilla si no desea ser localizado/a
                        </label>
                    </div>
                </div>
            </div>
            <!-- Aqu칤 seguir칤an otras pantallas, m칩dulos, modales, etc. -->
            <!-- ... -->
        </main>
    </div>
    <!-- Resto de modales, QR, y otras pantallas y funcionalidades aqu칤 ... -->
</body>
</html>
<!-- Contin칰a el contenido, modales, formularios, etc. -->
...
<!-- Este bloque contiene la pesta침a de pre-filiaci칩n, los modales de QR, usuarios, cambios de contrase침a, derivaciones, y el footer con carga del script principal. -->
<script type="module" src="script.js"></script>
</body>
</html>
    <div id="modal-cama" class="modal-overlay hidden" onclick="if(event.target===this)window.cerrarMapaCamas()">
        <div class="modal-content modal-lg">
            <span class="close-modal" onclick="window.cerrarMapaCamas()">&times;</span>
            <h3>Seleccionar Cama</h3>
            <p style="font-size:0.8rem;color:#666;">Verde Borde=Sugerencia | Naranja=Reserva Familia</p>
            <div id="grid-camas" class="bed-grid"></div>
        </div>
    </div>
    <div id="modal-bed-info" class="modal-overlay hidden" onclick="if(event.target===this)this.classList.add('hidden')">
        <div class="modal-content modal-lg" style="text-align:center; padding:40px;">
            <span class="close-modal" onclick="document.getElementById('modal-bed-info').classList.add('hidden')">&times;</span>
            <div style="font-size:3rem; color:var(--primary); margin-bottom:10px;">
                <i class="fa-solid fa-user-check"></i>
            </div>
            <h3 style="color:var(--text-light);">Cama <span id="info-cama-num"></span></h3>
            <h2 id="info-nombre-completo" style="color:var(--primary);"></h2>
            <p><span id="info-telefono"></span></p>
            <br>
            <button id="btn-historial-cama" class="dark hidden" style="margin-bottom:15px;">游닆 Ver Historial</button>
            <div style="margin-top:20px; text-align:left;">
                <h4 style="border-bottom:1px solid #eee; padding-bottom:5px;">Unidad Familiar</h4>
                <div id="info-familia-detalle"></div>
            </div>
        </div>
    </div>
    <div id="modal-vincular-familia" class="modal-overlay hidden" style="z-index: 2000;" onclick="if(event.target===this)this.classList.add('hidden')">
        <div class="modal-content">
            <span class="close-modal" onclick="document.getElementById('modal-vincular-familia').classList.add('hidden')">&times;</span>
            <h3>Unir a Familia</h3>
            <input type="text" id="search-vincular" placeholder="Buscar..." onkeyup="window.buscarParaVincular()" autocomplete="off">
            <div id="resultados-vincular" class="search-results hidden"></div>
        </div>
    </div>
    <div id="modal-albergue" class="modal-overlay hidden" onclick="if(event.target===this)this.classList.add('hidden')">
        <div class="modal-content">
            <span class="close-modal" onclick="document.getElementById('modal-albergue').classList.add('hidden')">&times;</span>
            <h3 id="mto-modal-title">Nuevo</h3>
            <label>Nombre</label><input type="text" id="mto-nombre">
            <div class="row">
                <div class="col"><label>Cap</label><input type="number" id="mto-capacidad"></div>
                <div class="col"><label>Cols</label><input type="number" id="mto-columnas" value="8"></div>
            </div>
            <div class="btn-row"><button class="primary" onclick="window.guardarAlbergue()">Guardar</button></div><br>
            <button id="btn-delete-albergue" class="danger hidden" style="width:100%" onclick="window.eliminarAlbergueActual()">Eliminar Albergue</button>
        </div>
    </div>
    <div id="modal-crear-usuario" class="modal-overlay hidden" onclick="if(event.target===this)this.classList.add('hidden')">
        <div class="modal-content">
            <span class="close-modal" onclick="document.getElementById('modal-crear-usuario').classList.add('hidden')">&times;</span>
            <h3 id="user-modal-title">Usuario</h3>
            <label>Nombre</label><input type="text" id="new-user-name">
            <label>Rol</label><select id="new-user-role"></select>
            <label>Email</label><input type="email" id="new-user-email">
            <label>Contrase침a</label><input type="password" id="new-user-pass">
            <p id="edit-pass-warning" style="display:none;color:orange;font-size:0.8em;">Use reset email.</p>
            <div style="margin: 15px 0; padding: 10px; background: #f8fafc; border-radius: 8px;">
                <label class="toggle-switch"><input type="checkbox" class="toggle-input" id="new-user-active" checked><span class="toggle-slider"></span><span style="font-size:0.9rem; font-weight:600; margin-left:10px;">Usuario Activo</span></label>
            </div>
            <div class="btn-row"><button id="btn-save-user" class="primary" onclick="window.guardarUsuario()">Guardar</button></div><br>
            <button id="btn-delete-user" class="danger hidden" style="width:100%" onclick="window.eliminarUsuario()">Eliminar Usuario</button>
        </div>
    </div>
    <div id="modal-change-pass" class="modal-overlay hidden" onclick="if(event.target===this)this.classList.add('hidden')">
        <div class="modal-content">
            <span class="close-modal" onclick="document.getElementById('modal-change-pass').classList.add('hidden')">&times;</span>
            <h3>Cambiar Contrase침a</h3>
            <label>Contrase침a Actual</label><input type="password" id="chg-old-pass">
            <label>Nueva Contrase침a</label><input type="password" id="chg-new-pass">
            <label>Confirmar Nueva</label><input type="password" id="chg-confirm-pass">
            <div class="btn-row"><button class="primary" onclick="window.ejecutarCambioPass()">Actualizar</button></div>
        </div>
    </div>
    <div id="modal-historial" class="modal-overlay hidden" onclick="if(event.target===this)this.classList.add('hidden')">
        <div class="modal-content">
            <span class="close-modal" onclick="document.getElementById('modal-historial').classList.add('hidden')">&times;</span>
            <h3 id="hist-modal-header">Historial de Movimientos</h3>
            <div id="historial-content" style="max-height:60vh; overflow-y:auto; margin-top:15px;"></div>
        </div>
    </div>
    <!-- M치s modales y scripts... -->
    <script type="module" src="script.js"></script>
</body>
</html>
